<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
 
    <title>Start Up</title>
 
    <style type="text/css">
        .imgs_wrap {
            width: 600px;
            margin-top: 50px;
        }
        .imgs_wrap img {
            max-width: 200px;
        }
 
    </style>
 
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.5.1.min.js" charset="utf-8"></script>
    <script type="text/javascript">
        
        var sel_files = [];
 
        $(document).ready(function() {
            $("#input_imgs").on("change", handleImgsFilesSelect);
        }); 
 
        function handleImgsFilesSelect(e) {
            var files = e.target.files;
            var filesArr = Array.prototype.slice.call(files);
 
            filesArr.forEach(function(f) {
                if(!f.type.match("image.*")) {
                    alert("확장자는 이미지 확장자만 가능합니다.");
                    return;
                }
 
                sel_files.push(f);
 
                var reader = new FileReader();
                reader.onload = function(e) {
                    var img_html = "<img src=\"" + e.target.result + "\" />";
                    $(".imgs_wrap").append(img_html);
                }
                reader.readAsDataURL(f);
            });
        }

        function openAlbum() {
        	if(navigator.userAgent.indexOf('iOS') > -1 || navigator.userAgent.indexOf('iPhone') > -1 || navigator.userAgent.indexOf('iPad') > -1) {
                var message = {
                    'func' : 'onOpenGallery'
                };
                window.webkit.messageHandlers.AppJSInterface.postMessage(message);
			}
        }

        var saveImages = [];

		function setImages(key, value, mimeType) {
			// 데이터 저장
			saveImages.push({id: key, name: value});

			var img = new Image();
		    img.src = 'data:' + mimeType + ';base64,' + value;
		    document.getElementById('main').appendChild(img);
		}

		function deleteImage() {
			if(navigator.userAgent.indexOf('iOS') > -1 || navigator.userAgent.indexOf('iPhone') > -1 || navigator.userAgent.indexOf('iPad') > -1) {
				var values = [];
				saveImages.for (var i = saveImages.length - 1; i >= 0; i--) {
					values.push(saveImages[i].key);
					console.log(values);
				}

                var message = {
                    'func' : 'onDeleteImage',
                    'params' : {
                    	'fileIds' : values
                    }
                };
                window.webkit.messageHandlers.AppJSInterface.postMessage(message);
			}
		}
 		

    </script>
</head>
 
<body>
 	<button onclick='openAlbum();' style='margin-top: 10px'>openAlbum()</button><br>
 
	<button onclick='deleteImage();' style='margin-top: 10px'>deleteImage()</button><br>

    <div>
        <h2><b>다중 이미지 미리보기</b></h2>
        <p class="title">다중 이미지 업로드</p>
        <input type="file" id="input_imgs" multiple />
    </div>
 
    <div id="main">
        
    </div>
 
 
</body>
</html>
